<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boleto Pullman Bus - Térmica 80mm</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <label for="ticket-selector" style="font-weight:600;">Selecciona tipo de boleto:</label>
        <select id="ticket-selector" style="margin: 10px 0; padding: 4px 8px; font-size: 15px;">
            <option value="1">Normal with MOT confirmed</option>
            <option value="2">with discount</option>
            <option value="3">with bifurcation</option>
            <option value="4">reprinted</option>
        </select>
        <div id="ticket-mockup-1" class="ticket-mockup"></div>
        <div id="ticket-mockup-2" class="ticket-mockup" style="display:none;"></div>
        <div id="ticket-mockup-3" class="ticket-mockup" style="display:none;"></div>
        <div id="ticket-mockup-4" class="ticket-mockup" style="display:none;"></div>
    </div>
    <div id="block-shortcuts-msg" style="display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:12px 24px;border-radius:8px;z-index:9999;font-size:16px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
        La impresión y menú del navegador están bloqueados.
    </div>
    <script src="script.js"></script>
    <script>
    // Cargar el contenido HTML de cada mockup externo
    function loadMockup(id, file) {
        fetch(file)
            .then(res => res.text())
            .then(html => {
                document.getElementById(id).innerHTML = html;
                // Volver a asociar el evento de impresión al botón dentro del mockup cargado
                const btn = document.getElementById(id).querySelector('.print-btn');
                if (btn) {
                    btn.onclick = triggerPrint;
                }
            });
    }
    loadMockup('ticket-mockup-1', 'ticket-mockup-1.html');
    loadMockup('ticket-mockup-2', 'ticket-mockup-2.html');
    loadMockup('ticket-mockup-3', 'ticket-mockup-3.html');
    loadMockup('ticket-mockup-4', 'ticket-mockup-4.html');

    // Mostrar solo el ticket seleccionado
    function showMockup(n) {
        for(let i=1;i<=4;i++) {
            document.getElementById('ticket-mockup-'+i).style.display = 'none';
        }
        document.getElementById('ticket-mockup-'+n).style.display = '';
    }
    // Mostrar el primero por defecto
    showMockup(1);
    document.getElementById('ticket-selector').addEventListener('change', function() {
        showMockup(this.value);
    });

    let shortcutsBlocked = true;
    function showBlockMsg() {
        const msg = document.getElementById('block-shortcuts-msg');
        msg.style.display = 'block';
        setTimeout(() => { msg.style.display = 'none'; }, 2200);
    }
    function blockShortcuts(e) {
        if (!shortcutsBlocked) return;
        // Bloquear Ctrl+P, Cmd+P
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'p') {
            e.preventDefault();
            showBlockMsg();
        }
        // Bloquear F12, Ctrl+Shift+I, Ctrl+Shift+C, Ctrl+Shift+J
        if (
            e.key === 'F12' ||
            ((e.ctrlKey || e.metaKey) && e.shiftKey && ['i','c','j'].includes(e.key.toLowerCase()))
        ) {
            e.preventDefault();
            showBlockMsg();
        }
    }
    document.addEventListener('keydown', blockShortcuts);
    // Bloquear menú contextual (botón derecho)
    document.addEventListener('contextmenu', function(e) {
        if (shortcutsBlocked) {
            e.preventDefault();
            showBlockMsg();
        }
    });
    // Opción para habilitar/deshabilitar el bloqueo
    window.setShortcutsBlocked = function(val) {
        shortcutsBlocked = !!val;
    }
    // Bloqueo visual en impresión: si shortcutsBlocked está activo, se agrega la clase block-print al body antes de imprimir
    let allowPrint = false;
    window.onbeforeprint = function() {
        if (shortcutsBlocked && !allowPrint) {
            document.body.classList.add('block-print');
        } else {
            document.body.classList.remove('block-print');
        }
    };
    window.onafterprint = function() {
        document.body.classList.remove('block-print');
        allowPrint = false;
    };
    // Solo permitir impresión desde el botón
    function triggerPrint() {
        allowPrint = true;
        window.print();
    }
    </script>
</body>
</html>